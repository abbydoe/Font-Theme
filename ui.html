<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Font Plugin</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/figma-plugin-ds.css"
    />
    <script
      src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
      type="module"
    ></script>

    <style>
      .lottie-container {
        display: none; /* Initially hidden */
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        text-align: center;
        align-items: center;
      }

      .container {
        height: 100vh;
        overflow: hidden;
      }
      /* Reset Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .dark {
        background-color: #1a1a1a;
        color: #ffffff;
      }
      body,
      html {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        font-size: 14px;
        color: #333;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background-color: #ffffff;
        color: #000000;
      }
      body.dark-mode {
        background-color: #1a1a1a;
        color: #ffffff;
      }

      #sidebar.dark {
        background-color: #1a1a1a;
        color: #ffffff;
      }

      #container {
        display: flex;
        height: 100%;
        width: 100%;
      }

      #sidebar {
        width: 200px; /* Reduce width to avoid pushing content */
        background-color: #f4f4f4;
        padding: 20px;
        overflow-y: auto;
        box-sizing: border-box; /* Include padding in the width calculation */
      }

      #sidebar h2 {
        font-size: 16px;
        margin-bottom: 8px;
      }

      #sidebar p {
        font-size: 12px;
        line-height: 1.5;
      }

      #sidebar hr {
        margin: 10px 0;
        border: none;
        border-top: 1px solid #ccc;
      }

      .tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        overflow: hidden; /* ✅ Prevents scrollbar on the tabs */
        max-height: fit-content; /* ✅ Ensures it only takes necessary space */
        flex-shrink: 0; /* ✅ Prevents it from shrinking */
      }

      .tab {
        flex: 1;
        text-align: center;
        padding: 10px;
        background-color: #f9f9f9;
        border: none;
        outline: none;
        cursor: pointer;
        font-size: 14px;
        color: #666; /* Inactive tab color */
        transition: 0.3s ease;
      }

      .tab.active {
        background-color: #fff;
        border-bottom: 2px solid black;
        color: black; /* Active tab color */
        font-weight: bold;
      }
      .tab:hover {
        background-color: rgb(111, 173, 212);
        color: white;
      }

      .content {
        display: block;
        padding-top: 20px;
        flex: 1;
      }

      .content.active {
        display: block;
      }

      .content h1 {
        font-size: 18px;
        margin-bottom: 10px;
      }

      .content p {
        font-size: 14px;
        margin-bottom: 10px;
      }

      .font-preview {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }

      .font-column {
        width: 48%;
      }

      .font-column h3 {
        font-size: 16px;
        margin-bottom: 10px;
      }

      .font-weight {
        font-size: 12px;
        font-weight: bold;
        margin: 5px 0;
      }

      .font-sample {
        font-size: 14px;
        margin: 5px 0 10px;
      }

      .button-container {
        display: flex;
        justify-content: space-between;
        padding-top: 20px;
        transition: 0.3s ease;
      }

      .find-font-button button {
        width: 100%;
        /* Make the button take the full width of its parent container */
      }

      .dark .switch__label {
        color: #ffffff;
      }

      button {
        padding: 10px;
        border: none;
        background-color: black;
        color: white;
        font-size: 14px;
        cursor: pointer;
        flex: 1;
        margin: 0 10px;
      }

      /* Prevent horizontal scrolling for the entire content */
      #find-font {
        overflow-x: hidden; /* Disable horizontal scrolling */
        width: 100%; /* Ensure it takes up the full width of its container */
        box-sizing: border-box; /* Include padding and borders in width calculation */
      }

      /* Ensure the textarea fits within the parent */
      #font-feeling {
        width: 100%; /* Responsive to parent container */
        max-width: 100%; /* Prevent overflow beyond parent */
        height: 50px;
        padding: 10px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-bottom: 20px;
        resize: none; /* Disable manual resizing */
        box-sizing: border-box; /* Include padding and borders in width */
      }

      .font-pair-options label {
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px; /* Space between radio button and label text */
        word-wrap: break-word; /* Ensure text wraps if it overflows */
      }

      body.dark button {
        background-color: #ffffff;
        color: #000000;
        border: 1px solid #ffffff;
      }

      p[contenteditable]:focus {
        outline: none; /* Remove default focus outline */
        border: 1px solid #ccc; /* Add a light border */
        border-radius: 4px; /* Optional: Rounded corners */
        padding: 5px; /* Optional: Inner padding for better spacing */
        background-color: #f9f9f9; /* Optional: Subtle background color */
      }

      /* General content wrapper styles to prevent overflow */
      .content {
        width: 100%; /* Ensure content spans the container */
        max-width: 100%; /* Prevent horizontal overflow */
        box-sizing: border-box; /* Include padding and borders in width */
        padding: 10px; /* Optional padding */
      }
      /* General styles for the font categories */

      .subheader {
        font-size: 12px;
        font-family: "Raleway", sans-serif; /* Correct quotes and fallback font */
        font-weight: 400;
        color: #666;
        padding-top: 8px;
        padding-bottom: 4px;
        padding-left: 8px;
      }

      .font-card {
        flex: 1;
        min-width: 150px; /* Minimum size for small screens */
        display: block;
        width: 50vh;
        padding-bottom: 8px;
        text-align: left;
        word-wrap: break-word;
        overflow-wrap: break-word;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .font-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .font-card h3 {
        font-size: 16px;
        padding-bottom: 8px;
        padding-top: 0px;
        padding-left: 8;
      }

      .font-card p {
        font-size: 14px;
        /* Remove the outlined box around the body text */
        margin: 0px 8px;
        border: none; /* Ensure no border is applied */
        padding: 0px; /* Remove any padding */
        background: none; /* Remove background color, if any */
        box-shadow: none; /* Remove any shadow effects */
        word-wrap: break-word;
      }
      /* Ensure the buttons container fits within the parent */
      .button-container {
        display: flex;
        justify-content: space-between; /* Spread buttons evenly */
        margin-top: 20px;
        width: 100%; /* Ensure it spans the full width of the parent */
        padding: 0; /* Remove extra padding */
        gap: 10px; /* Add spacing between buttons */
        box-sizing: border-box; /* Include padding and borders in width calculations */
        overflow-x: hidden; /* Prevent horizontal scrolling */
      }

      /* Ensure buttons fit within the container */
      .button-container button {
        flex: 1; /* Distribute buttons evenly */
        padding: 10px;
        border: none;
        background-color: rgb(111, 173, 212);
        color: white;
        font-size: 14px;
        font-family: "Raleway", sans-serif; /* Correct quotes and fallback font */
        font-weight: 400;
        border-radius: 30px;
        cursor: pointer;
        box-sizing: border-box; /* Include padding and borders in width */
      }

      /* Prevent horizontal overflow on the main content area */
      #main {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 20px;
        width: 100%; /* Ensure it spans the full width */
        box-sizing: border-box; /* Include padding in width calculations */
        overflow-x: hidden; /* Eliminate horizontal scrolling */
        overflow-y: hidden;
      }

      .option:hover {
        color: rgb(111, 173, 212);
      }


      .options {
        display: flex;
        justify-content: space-between;
        margin: 0;
        padding: 0; /* ✅ Ensure no extra padding is adding space */
      }

      .options li {
        flex: 1;
        display: inline-block;
      }

      .option-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        visibility: hidden;
        overflow-y: auto; /* ✅ Enables scrolling */
        transition: opacity 0.2s ease-in-out;
        padding: 16px;
        box-sizing: border-box;
      }

      /* ✅ Show only the active tab */
      .option-content.active {
        position: relative;
        opacity: 1;
        visibility: visible;
        height: 100%;
        max-height: calc(100vh - 200px);
        overflow-y: auto; /* ✅ Ensures scrolling works */
      }

      .find-font-content {
        display: block;
      }

      button.option {
        background-color: transparent;
        color: #666;
        border-bottom: 2px solid #ccc;
        margin-left: 8px;
        margin-right: 24px;
        padding-left: 0%;
        transition: border-bottom-color 0.3s ease;
      }

      button.option:hover {
        border-bottom: 2px solid rgb(111, 173, 212); /* Added size and style */
      }

      .option:hover {
        color: rgb(111, 173, 212);
      }

      /* Active state */
      .option.active {
        color: #000;
        border-bottom: 2px solid black;
        font-weight: bold;
        flex-grow: 1;
      }

      .option.active::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: -3px;
        width: 100%;
        height: 4px;
        border-radius: 2px;
        transition: width 0.3s ease-in-out;
        border-bottom: 2px solid black;
      }

      .content {
        display: none; /* Hide all content by default */
        background-color: #ffffff;
      }

      .content.active {
        display: block; /* Show only active content */
      }

      /* Button hover effect */
      .button-container button:hover {
        background-color: rgb(93, 148, 183);
        transition: 0.3s ease;
      }
      fieldset {
        border: none;
        padding: 0;
        margin: 0;
      }
      .spinner-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(0, 0, 0, 0.2);
        border-top: 4px solid #007aff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .theme-Headings {
        font-weight: normal;
      }
      .font-row {
        text-align: left; /* Ensures inherited left alignment */
        display: block;
        /* padding-left: 8px;
        padding-right: 8px; */
      }
      .pair1 {
        flex: auto;
        min-width: 150px;
        display: block;
        width: auto;
        padding: 10px;
        text-align: left;
        word-wrap: break-word;
        overflow-wrap: break-word;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .pair1 {
        display: flex; /* ✅ Use flex to position both divs side by side */
        flex-direction: column; /* ✅ Stack header & body fonts inside the card */
        align-items: flex-start; /* ✅ Align text to the left */
        min-width: 150px;
        width: auto;
        padding: 10px; /* ✅ Re-enable padding for spacing */
        text-align: left;
        word-wrap: break-word;
        overflow-wrap: break-word;
        border: 1px solid #ddd; /* ✅ Add a light border to define the card */
        border-radius: 5px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        background: white; /* ✅ Ensure background is visible */
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1); /* ✅ Add subtle shadow */
      }

      .pair1 > div {
        margin-bottom: 10px; /* ✅ Add spacing between the two font sections */
        width: 100%; /* ✅ Make sure they take full width inside the card */
      }

      .pair2 {
        display: flex;
      }
      .pair3 {
        display: flex;
      }
      .pair4 {
        display: flex;
      }
      .pair5 {
        display: flex;
      }
      .pair6 {
        display: flex;
      }
      .pair7 {
        display: flex;
      }
      .pair8 {
        display: flex;
      }
      .pair9 {
        display: flex;
      }
      .pair10 {
        display: flex;
      }
      .pair11 {
        display: flex;
      }
      .pair12 {
        display: flex;
      }
      .content.active {
        display: flex;
        flex-direction: column; /* Stacks items vertically */
        justify-content: center; /* Centers items vertically */
        align-items: center; /* Centers items horizontally */
        height: 100vh;
        /* Ensres the container takes the full height of the viewport */
      }
      .searchH2 {
        margin-bottom: 20px;
      }
      #font-feeling::placeholder {
        font-family: "Open Sans";
        font-weight: lighter;
        color: gray;
        font-size: 16px;
      }

      .saved-font-item {
        list-style: none;
        padding: 12px;
        margin-bottom: 6px; /* Slightly tighter spacing between cards */
        background: #f9f9f9;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        cursor: pointer;
        transition: background 0.2s ease-in-out;
        display: flex;
        flex-direction: column;
        gap: 6px; /* More spacing between sections */
      }

      .saved-font-item:hover {
        background: #f1f1f1;
      }

      .saved-font-content {
        display: flex;
        flex-direction: column;
      }

      /* Adjust Header & Body headings */
      .saved-font-header,
      .saved-font-body {
        margin: 0 0 0 0; /* Creates separation between heading and font name */
        font-size: 11px;
        font-weight: 600;
        color: #222;
      }

      .saved-font-name {
        margin: 0;
        font-size: 11px;
        color: #555;
      }

      .popup-overlay {
        position: fixed;
        top: 100px;
        left: 270px;
        width: auto;
        background: white;
        border: none;
        border-radius: 8px;
        padding: 16px;
        z-index: 1005;
        opacity: 0;
        visibility: hidden;
        transform: translateX(-10px);
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        height: 90vh; /* Prevent it from taking up the whole screen */
        overflow: hidden; /* Prevents overflow from breaking layout */
        display: flex;
        flex-direction: column;
      }

      .popup-content {
        flex: 1; /* Takes up available space */
        overflow-y: auto; /* Enables vertical scrolling */
        padding: 16px;
      }

      /* ✅ Show pop-up when open */
      .popup-overlay.open {
        opacity: 1;
        visibility: visible;
        transform: translateX(0);
      }

      .popup-overlay.open .popup-footer {
        position: fixed;
        bottom: 0;
        left: 50%; /* ✅ Start from the center */
        transform: translateX(-50%); /* ✅ Shift left by half its width */
        width: 90%; /* ✅ Ensure it adapts to popup width */
        max-width: 600px; /* ✅ Ensure it doesn't stretch too wide */
        background-color: white;
        background: linear-gradient(
          to top,
          rgba(255, 255, 255, 1) 70%,
          rgba(255, 255, 255, 0) 100%
        );
        padding: 16px 20px;
        display: flex;
        gap: 12px;
        justify-content: center;
        z-index: 1001; /* ✅ Higher than the modal content */

        /* ✅ Stronger fade effect
        background: linear-gradient(
          to top,
          rgba(255, 255, 255, 1) 20%,
          rgba(255, 255, 255, 0.7) 50%,
          rgba(255, 255, 255, 0.4) 80%,
          rgba(255, 255, 255, 0) 100%
        );*/
      }

      /* ✅ Close button */
      #close-popup {
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: black;
      }

      #close-popup:hover {
        opacity: 0.7;
      }

      .popup-footer {
        position: fixed;
        bottom: 0;
        left: calc(
          200px + (100vw - 200px) / 2
        ); /* ✅ Centers between sidebar & right edge */
        transform: translateX(-50%); /* ✅ Ensures exact centering */
        width: calc(
          100vw - 220px
        ); /* ✅ Adjust to fit between sidebar & right */
        max-width: 900px; /* ✅ Prevent excessive width */
        background-color: white;
        padding-top: 50px;
        padding: 16px 20px;
        display: flex;
        gap: 12px;
        justify-content: center;
        z-index: 1000; /* ✅ Ensures it's above content */

        /* ✅ Stronger fade effect
        background: linear-gradient(
          to top,
          rgba(255, 255, 255, 1) 20%,
          rgba(255, 255, 255, 0.7) 50%,
          rgba(255, 255, 255, 0.4) 80%,
          rgba(255, 255, 255, 0) 100%
        );*/
      }

      /* ✅ Ensure content does not go under the buttons */
      .popup-content {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 100px; /* ✅ Leaves space so the last line of text is visible */
      }

      /* ✅ Adjust button size and placement */
      .popup-button {
        flex: 1;
        padding: 12px 16px;
        border-radius: 16px;
        border: none;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
        transition: all 0.2s ease-in-out;
        background: rgb(111, 173, 212);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* ✅ Hover effect */
      .popup-button:hover {
        background: rgb(93, 148, 183);
        transform: scale(1.04);
      }

      /* ✅ Click effect */
      .popup-button:active {
        transform: scale(0.98);
        opacity: 0.9;
      }

      li {
        list-style: none;
        margin-top: 8px;
        margin-bottom: 16px;
      }

      .font-row-theme {
        display: flex;
        flex-direction: row; /* Stacks multiple font-row sections */
        gap: 30px; /* Spacing between different font-row groups */
        width: 100%;
        /* padding: 0px 8px 0px 8px; */
      }

      .font-row {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        width: 100%;
        padding-bottom: 16px;
      }
      .theme-card {
        background: white;
        border-radius: 12px;
        padding: 16px;
        flex: 1;
        max-width: 48vh;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        cursor: pointer;

        h3,
        h4 {
          margin: 0;
          padding-left: 0px;
        }

        h3 {
          padding-bottom: 8px;
        }

        .header {
          font-size: 24px;
        }
        .body {
          font-size: 18px;
        }
        .subheader {
          font-size: 14px;
          color: gray;
        }
        .divider {
          margin: 16px 0px 16px 0px;
          border-bottom: 1px solid black;
        }
        .example {
          font-size: 16px;
          padding-bottom: 0px;
        }
      }
      #font-container {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        overflow-y: visible;
        padding: 0px 8px 72px 8px;
        /* Prevents internal clipping */
      }

      .options-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: calc(100vh - 200px); /* ✅ Ensures proper height */
      }
    </style>
  </head>
  <body>
    <!-- Loading Spinner -->
    <div id="loading-animation" class="lottie-container">
      <dotlottie-player
        src="https://lottie.host/1f1b3542-09a1-4a26-94a6-3a325d291461/FcuHe0HfQW.lottie"
        background="transparent"
        speed="1"
        style="width: 200px; height: 200px"
        loop
        autoplay
      >
      </dotlottie-player>
    </div>

    <div id="saved-font-popup" class="popup-overlay">
      <div class="popup-content">
        <button id="close-popup">✖</button>
        <div id="popup-font-details"></div>
      </div>
    </div>

    <div id="container">
      <!-- Sidebar -->
      <div id="sidebar">
        <h2>Saved Fonts</h2>
        <p>
          If you're not sure which font pair to use, you can save them here and
          decide later. Click on a saved font to review the font family details.
        </p>
        <!-- Switch -->
        <div class="switch">
          <input class="switch__toggle" type="checkbox" id="dark-mode-on" />
          <label class="switch__label" for="dark-mode-on">Dark Mode</label>
        </div>
        <div id="saved-fonts"></div>
      </div>

      <!-- Main Content -->
      <div id="main">
        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" id="find-font-tab">
            Search Font Theme
          </button>
          <button class="tab" data-tab="tab2" id="font-family-tab">
            Results
          </button>
          <button class="tab" id="all-font-categories-tab">
            Common Themes
          </button>
        </div>
        <!-- Find Font Content -->
        <div class="content active" id="find-font">
          <h2
            class="searchH2"
            style="font-family: 'Raleway'; font-weight: bold"
          >
            What feeling does your font need to have?
          </h2>
          <textarea
            id="font-feeling"
            type="vibe"
            placeholder="Example: Professional, but friendly and approachable."
          ></textarea>
          <div class="button-container find-font-button">
            <button id="find-font-btn">Find Font</button>
          </div>
        </div>

        <!-- Results tab content -->
        <div class="content" id="font-family">
          <ul class="options" style="display: block">
            <li>
              <button
                id="option1"
                class="option active"
                data-target="option1-content"
              >
                Option 1
              </button>
            </li>
            <li>
              <button id="option2" class="option" data-target="option2-content">
                Option 2
              </button>
            </li>
            <li>
              <button id="option3" class="option" data-target="option3-content">
                Option 3
              </button>
            </li>
            <li>
              <button id="option4" class="option" data-target="option4-content">
                Option 4
              </button>
            </li>
            <li>
              <button id="option5" class="option" data-target="option5-content">
                Option 5
              </button>
            </li>
          </ul>
          <div class="options-container">
            <div id="option1-content" class="option-content active"></div>
            <div id="option2-content" class="option-content"></div>
            <div id="option3-content" class="option-content"></div>
            <div id="option4-content" class="option-content"></div>
            <div id="option5-content" class="option-content"></div>
          </div>
        </div>

        <!-- All Font Themes Content -->
        <div class="content" id="all-font-categories">
          <div class="container" id="font-container"></div>
        </div>

        <!-- <div class="button-container" id="action-buttons" style="display: none">
          <button id="use-font">Use Font</button>
          <button id="save-font">Save for Later</button>
        </div> -->
      </div>
      <div id="plugin-container"></div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const tabs = document.querySelectorAll(".tab");
        const contents = document.querySelectorAll(".content");

        tabs.forEach((tab) => {
          tab.addEventListener("click", function () {
            // Remove 'active' class and reset display for all content sections
            tabs.forEach((t) => t.classList.remove("active"));
            contents.forEach((content) => {
              content.classList.remove("active");
              content.style.display = "none"; // Hide all content
              content.style.justifyContent = ""; // Reset centering
              content.style.alignItems = ""; // Reset centering
              content.style.height = ""; // Reset height
            });

            // Add 'active' class to the clicked tab and show its content
            this.classList.add("active");
            const contentId = this.id.replace("-tab", "");
            const targetContent = document.getElementById(contentId);

            if (targetContent) {
              targetContent.classList.add("active");
              targetContent.style.display = "block"; // Use block for default layout

              // Apply flex centering ONLY for the first tab's content
              if (contentId === "find-font") {
                targetContent.style.display = "flex";
                targetContent.style.justifyContent = "center";
                targetContent.style.alignItems = "center";
                targetContent.style.height = "100vh";
              }
            }
          });
        });
      });

      // Javascript for option content in results tabs
      const optionButtons = document.querySelectorAll(".option");
      const optionContents = document.querySelectorAll(".option-content");

      optionButtons.forEach((button) => {
        button.addEventListener("click", function () {
          // ✅ Remove 'active' class from all buttons
          optionButtons.forEach((btn) => btn.classList.remove("active"));

          // ✅ Add 'active' class to the clicked button
          this.classList.add("active");

          // ✅ Hide all content sections (keep them in the layout)
          optionContents.forEach((content) => {
            content.classList.remove("active");
          });

          // ✅ Show the corresponding tab and ensure it has scrollable content
          const targetId = this.getAttribute("data-target");
          const targetContent = document.getElementById(targetId);
          if (targetContent) {
            targetContent.classList.add("active");

            // ✅ Ensure it has proper height and scrolling enabled
            targetContent.style.height = "100%";
            targetContent.style.maxHeight = "calc(100vh - 200px)";
            targetContent.style.overflowY = "auto";
          }
        });
      });

      //Toggle Switch
      const body = document.getElementById("dark-mode-on");
      const sidebar = document.getElementById("sidebar");
      body.addEventListener("click", function () {
        document.body.classList.toggle("dark");
        if (sidebar) sidebar.classList.toggle("dark");
      });

      // Find Font Button
      const findFontButton = document.getElementById("find-font-btn");

      findFontButton.addEventListener("click", () => {
        const vibe = document.getElementById("font-feeling").value.trim();
        const fontPairing = 2; // Hardcoded value

        // Validate input
        if (!vibe) {
          alert("Please enter a vibe before finding font pairings.");
          return;
        }
        parent.postMessage(
          { pluginMessage: { type: "find-font", vibe, fontPairing } },
          "*"
        );
      });

      window.onmessage = (event) => {
        const message = event.data.pluginMessage;

        // ✅ Show Lottie animation
        if (message.type === "show-spinner") {
          document.getElementById("loading-animation").style.display = "flex";
          document.getElementById("container").style.display = "none";
        }

        // ❌ Hide Lottie animation
        if (message.type === "hide-spinner") {
          document.getElementById("loading-animation").style.display = "none";
          document.getElementById("container").style.display = "flex";
        }

        // ✅ Process font pairings (if applicable)
        if (message.type === "font-pairings-response") {
          console.log("Font pairings received:", message.data);
          document.getElementById("loading-animation").style.display = "none";
          document.getElementById("container").style.display = "flex"; // Hide spinner
          displayFontPairingsInOptions(message.data); // Existing function to update UI
        }

        if (message.type === "error") {
          console.error("Error:", message.message);
          alert(message.message); // Show an error message in UI
        }
      };

      async function displayFontPairingsInOptions(fontPairs) {
        console.log(fontPairs);
        const maxOptions = 5;

        for (let i = 0; i < maxOptions; i++) {
          let optionContent = document.getElementById(`option${i + 1}-content`);
          if (!optionContent) continue; // Clear existing content

          let pair = fontPairs[i];
          console.log(`Updating option ${i + 1} with fonts:`, pair);

          optionContent = createPopupContent(optionContent, pair, true);
        }

        // ✅ Switch to Results tab automatically
        switchToResultsTab();
      }

      // Global variables
      let globalFontFeeling = document
        .getElementById("font-feeling")
        .value.trim();
      let globalDateText = new Date().toDateString();
      let globalParagraphText =
        "This paragraph is how these fonts look when paired together. You can edit this text.";

      // ✅ Update `globalFontFeeling` when the user types in the textarea
      document.getElementById("font-feeling").addEventListener("input", (e) => {
        globalFontFeeling = e.target.value.trim();
        updateAllElements(); // Update all existing elements
      });

      // ✅ Update global values when any `h1`, `p.date`, or `p.editable-paragraph` is edited
      document.addEventListener("input", (e) => {
        if (e.target.matches("h1[contenteditable='true']")) {
          globalFontFeeling = e.target.textContent.trim();
        }
        if (e.target.matches("p.date")) {
          globalDateText = e.target.textContent.trim();
        }
        if (e.target.matches("p.editable-paragraph")) {
          globalParagraphText = e.target.textContent.trim();
        }
      });

      // ✅ Function to update all existing elements in the DOM
      function updateAllElements() {
        document
          .querySelectorAll("h1[contenteditable='true']")
          .forEach((el) => (el.textContent = globalFontFeeling));
        document
          .querySelectorAll("p.date")
          .forEach((el) => (el.textContent = globalDateText));
        document
          .querySelectorAll("p.editable-paragraph")
          .forEach((el) => (el.textContent = globalParagraphText));
      }

      // ✅ Use MutationObserver to detect new elements added to the DOM and update them
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (node.nodeType === 1) {
              // Ensure it's an element node
              if (node.matches && node.matches("h1[contenteditable='true']")) {
                node.textContent = globalFontFeeling;
              }
              if (node.matches && node.matches("p.date")) {
                node.textContent = globalDateText;
              }
              if (node.matches && node.matches("p.editable-paragraph")) {
                node.textContent = globalParagraphText;
              }
              // If a whole new section was added, update all contained elements
              node
                .querySelectorAll?.("h1[contenteditable='true']")
                .forEach((el) => (el.textContent = globalFontFeeling));
              node
                .querySelectorAll?.("p.date")
                .forEach((el) => (el.textContent = globalDateText));
              node
                .querySelectorAll?.("p.editable-paragraph")
                .forEach((el) => (el.textContent = globalParagraphText));
            }
          });
        });
      });

      // Start observing the body for any new elements being added
      observer.observe(document.body, { childList: true, subtree: true });

      async function createPopupContent(optionContent, pair, isResultstab) {
        // ✅ Rebuild missing elements dynamically
        optionContent.innerHTML = "";

        // Heading
        let editableHeader = document.createElement("h1");
        editableHeader.setAttribute("contenteditable", "true");
        editableHeader.textContent = globalFontFeeling || "Hello!";
        editableHeader.style.fontFamily = pair.header.font; // Apply header font dynamically
        optionContent.appendChild(editableHeader);

        // Date
        let date = document.createElement("p");
        date.classList.add("date");
        date.textContent = globalDateText || Date().toDateString(); // Use today's date
        date.setAttribute("contenteditable", "true");
        optionContent.appendChild(date);

        // Editable paragraph
        let editableParagraph = document.createElement("p");
        editableParagraph.classList.add("editable-paragraph");
        editableParagraph.setAttribute("contenteditable", "true");
        editableParagraph.textContent =
          globalParagraphText ||
          "This paragraph is how these fonts look when paired together. You can edit this text.";
        editableParagraph.style.fontFamily = pair.body.font; // Apply body font dynamically
        optionContent.appendChild(editableParagraph);

        // Font preview container
        let fontPreview = document.createElement("div");
        fontPreview.classList.add("font-preview");

        // ✅ Function to create font preview columns
        function createFontColumn(fontName, weights) {
          let column = document.createElement("div");
          column.classList.add("font-column");

          let fontTitle = document.createElement("h3");
          fontTitle.textContent = fontName;
          fontTitle.style.fontFamily = fontName;
          column.appendChild(fontTitle);

          weights.forEach((weight) => {
            let weightLabel = document.createElement("p");
            weightLabel.classList.add("font-weight");
            weightLabel.textContent = getWeightName(weight);

            let weightSample = document.createElement("p");
            weightSample.classList.add("font-sample");
            weightSample.textContent = "AaBbDdEeGgMmOoRrSs\n1234567890!?@#$%";
            weightSample.style.fontFamily = fontName;
            weightSample.style.fontWeight = weight;

            column.appendChild(weightLabel);
            column.appendChild(weightSample);
          });

          return column;
        }

        // ✅ Append new font columns
        fontPreview.appendChild(
          createFontColumn(pair.header.font, pair.header.weights)
        );
        fontPreview.appendChild(
          createFontColumn(pair.body.font, pair.body.weights)
        );

        optionContent.appendChild(fontPreview);

        // Ensure buttons are inside the content
        let buttonContainer = document.createElement("div");
        buttonContainer.classList.add("popup-footer");
        let savedFontPairs = []; // Global array to track saved pairs

        let useFontButton = document.createElement("button");
        useFontButton.id = "use-font";
        useFontButton.classList.add("popup-button");
        useFontButton.setAttribute("data-font-family", pair.header.font);
        useFontButton.setAttribute(
          "data-font-weights",
          JSON.stringify(pair.header.weights)
        );
        useFontButton.setAttribute("data-header-font", pair.header.font);
        useFontButton.setAttribute(
          "data-header-weights",
          JSON.stringify(pair.header.weights)
        );
        useFontButton.setAttribute("data-body-font", pair.body.font);
        useFontButton.setAttribute(
          "data-body-weights",
          JSON.stringify(pair.body.weights)
        ); // Convert the weights array to a string

        useFontButton.textContent = "Create Text Style";
        let saveFontButton = document.createElement("button");
        saveFontButton.id = "save-font";
        saveFontButton.classList.add("popup-button");
        saveFontButton.textContent = "Save for Later";

        saveFontButton.setAttribute("data-header-font", pair.header.font);
        saveFontButton.setAttribute("data-body-font", pair.body.font);

        buttonContainer.appendChild(useFontButton);
        buttonContainer.appendChild(saveFontButton);
        optionContent.appendChild(buttonContainer);

        saveFontButton.addEventListener("click", function () {
          // Retrieve font data from the button's data attributes
          const headerFont = saveFontButton.getAttribute("data-header-font");
          const bodyFont = saveFontButton.getAttribute("data-body-font");

          // Get the option content
          let optionContent;
          if (isResultstab) {
            optionContent = saveFontButton.closest(".option-content");
          } else {
            optionContent = saveFontButton.closest("#popup-font-details");
          }

          // Check if already saved
          const alreadySaved = savedFontPairs.some(
            (pair) => pair.header === headerFont && pair.body === bodyFont
          );

          if (alreadySaved) {
            return;
          }

          // Add the new font pair to the savedFontPairs array
          savedFontPairs.push({ header: headerFont, body: bodyFont });

          // Create and append the new list item
          const savedFontsList = document.getElementById("saved-fonts");
          if (!savedFontsList) {
            console.error("Saved fonts container not found.");
            return;
          }

          // Create a new list item and add it to the sidebar
          const listItem = document.createElement("li");
          listItem.classList.add("saved-font-item");

          // Create the content container
          const contentDiv = document.createElement("div");
          contentDiv.classList.add("saved-font-content");

          // Create and style the header font elements
          const headerTitle = document.createElement("h2");
          headerTitle.classList.add("saved-font-header");
          headerTitle.textContent = headerFont;
          headerTitle.style.fontFamily = headerFont; // Apply the header font family
          headerTitle.style.fontWeight = "bold";

          const headerLabel = document.createElement("p");
          headerLabel.classList.add("saved-font-name");
          headerLabel.textContent = "Header";

          // Create and style the body font elements
          const bodyTitle = document.createElement("h2");
          bodyTitle.classList.add("saved-font-body");
          bodyTitle.textContent = bodyFont;
          bodyTitle.style.fontFamily = bodyFont;
          bodyTitle.style.fontWeight = "normal";

          const bodyLabel = document.createElement("p");
          bodyLabel.classList.add("saved-font-name");
          bodyLabel.textContent = "Body";

          // Append elements to the content container
          contentDiv.appendChild(headerLabel);
          contentDiv.appendChild(headerTitle);
          contentDiv.appendChild(bodyLabel);
          contentDiv.appendChild(bodyTitle);

          // Append the content container to the list item
          listItem.appendChild(contentDiv);

          // Store the option content in dataset
          listItem.dataset.optionContent = optionContent.innerHTML;

          const popupOverlay = document.getElementById("saved-font-popup");
          const popupContent = document.getElementById("popup-font-details");
          const closePopupButton = document.getElementById("close-popup");

          // ✅ Make the list item clickable to display saved option content
          listItem.addEventListener("click", () => {
            // ✅ Update content inside pop-up
            popupContent.innerHTML = listItem.dataset.optionContent;

            // ✅ Dynamically Position the Pop-up Next to Sidebar
            let sidebar = document.getElementById("sidebar");
            let sidebarRect = sidebar.getBoundingClientRect();
            let menu = document.querySelector(".tabs");
            let menuRect = menu.getBoundingClientRect();
            popupOverlay.style.top = `${menuRect.bottom}px`; // Position right below the menu
            popupOverlay.style.left = `${sidebarRect.right}px`; // Position right of sidebar

            // ✅ Open the pop-up
            popupOverlay.classList.add("open");
            const popupSaveButton = popupOverlay.querySelector("#save-font");
            if (popupSaveButton) {
              popupSaveButton.textContent = "Unsave"; // ✅ Change text inside popup
            }

            popupSaveButton.addEventListener("click", () => {
              if (popupSaveButton.textContent === "Unsave") {
                // Remove from savedFontPairs array
                savedFontPairs = savedFontPairs.filter(
                  (pair) =>
                    !(pair.header === headerFont && pair.body === bodyFont)
                );

                // Remove the item from the sidebar
                listItem.remove();
                closePopup();
              }
            });
          });

          // Append the new list item to the sidebar
          savedFontsList.appendChild(listItem);

          // ✅ Close pop-up when clicking the close button
          closePopupButton.addEventListener("click", () => {
            popupOverlay.classList.remove("open");
          });

          // ✅ Close pop-up when clicking outside it
          // Select the tab elements
          const findFontTab = document.getElementById("find-font-tab");
          const resultsTab = document.getElementById("font-family-tab");
          const commonThemesTab = document.getElementById(
            "all-font-categories-tab"
          );

          // Function to close the popup
          const closePopup = () => {
            popupOverlay.classList.remove("open");
          };

          // Attach event listeners to the tabs
          findFontTab.addEventListener("click", closePopup);
          resultsTab.addEventListener("click", closePopup);
          commonThemesTab.addEventListener("click", closePopup);

          savedFontsList.appendChild(listItem);
          console.log("Font pair saved.");
        });

        // ✅ Dynamically load fonts before applying them
        await loadGoogleFont(pair.header.font);
        await loadGoogleFont(pair.body.font);

        return optionContent;
      }

      document.addEventListener("click", async function (event) {
        if (event.target.id === "use-font") {
          const headerFontFamily =
            event.target.getAttribute("data-header-font");
          const headerFontWeights = JSON.parse(
            event.target.getAttribute("data-header-weights")
          );
          const bodyFontFamily = event.target.getAttribute("data-body-font");
          const bodyFontWeights = JSON.parse(
            event.target.getAttribute("data-body-weights")
          );

          window.onload = async () => {
            await loadAllFonts();
            console.log("Common Fonts are ready to use in the UI!");
          };

          window.parent.postMessage(
            {
              pluginMessage: {
                type: "create-text-style",
                fonts: [
                  {
                    fontFamily: headerFontFamily,
                    fontWeights: headerFontWeights,
                  }, // Header font
                  {
                    fontFamily: bodyFontFamily,
                    fontWeights: bodyFontWeights,
                  }, // Body font
                ],
              },
            },
            "*"
          );
        }
      });

      // ✅ Function to load Google Fonts dynamically
      async function loadGoogleFont(fontName) {
        if (!fontName) return;
        const fontUrl = `https://fonts.googleapis.com/css2?family=${fontName.replace(
          / /g,
          "+"
        )}:wght@100;200;300;400;500;600;700;800;900&display=swap`;
        if (!document.querySelector(`link[href="${fontUrl}"]`)) {
          const link = document.createElement("link");
          link.href = fontUrl;
          link.rel = "stylesheet";
          document.head.appendChild(link);
          console.log(`Font ${fontName} loaded dynamically.`);
        }
      }

      // ✅ Function to convert font weight numbers to readable names
      function getWeightName(weight) {
        const weightMap = {
          100: "Thin",
          200: "Extra Light",
          300: "Light",
          400: "Regular",
          500: "Medium",
          600: "Semi Bold",
          700: "Bold",
          800: "Extra Bold",
          900: "Black",
        };
        return weightMap[weight] || `Weight ${weight}`;
      }

      function switchToResultsTab() {
        let resultsTab = document.getElementById("font-family-tab"); // Adjust the ID if needed
        if (resultsTab) {
          resultsTab.click(); // Simulate a click event on the Results tab
          console.log("Switched to Results tab programmatically!");
        } else {
          console.warn("Results tab not found! Make sure the ID is correct.");
        }
      }
      const commonThemes = [
        {
          category: "Friendly and Approachable",
          pairs: [
            {
              header: { font: "Fredoka", weights: [400, 500, 600, 700] },
              body: { font: "Quicksand", weights: [300, 400, 500, 600, 700] },
            },
            {
              header: { font: "Cabin", weights: [400, 500, 600, 700] },
              body: { font: "Hind", weights: [300, 400, 500, 600, 700] },
            },
            {
              header: { font: "Baloo 2", weights: [400, 500, 600, 700, 800] },
              body: { font: "Fira Sans", weights: [300, 400, 500, 600, 700] },
            },
            {
              header: { font: "Manrope", weights: [400, 500, 600, 700, 800] },
              body: { font: "Asap", weights: [300, 400, 500, 600, 700] },
            },
          ],
        },
        {
          category: "Elegant and Classic",
          pairs: [
            {
              header: { font: "Prata", weights: [400] },
              body: { font: "Domine", weights: [400, 500, 600, 700] },
            },
            {
              header: { font: "Lustria", weights: [400] },
              body: { font: "Cardo", weights: [400, 700] },
            },
            {
              header: {
                font: "Vollkorn",
                weights: [400, 500, 600, 700, 800, 900],
              },
              body: { font: "Neuton", weights: [200, 300, 400, 700, 800] },
            },
            {
              header: { font: "Libre Caslon Text", weights: [400, 700] },
              body: {
                font: "Spectral",
                weights: [200, 300, 400, 500, 600, 700, 800],
              },
            },
          ],
        },
        {
          category: "Modern and Minimalist",
          pairs: [
            {
              header: { font: "Questrial", weights: [400] },
              body: {
                font: "Exo 2",
                weights: [300, 400, 500, 600, 700, 800, 900],
              },
            },
            {
              header: {
                font: "Barlow Condensed",
                weights: [100, 200, 300, 400, 500, 600, 700, 800, 900],
              },
              body: {
                font: "Heebo",
                weights: [300, 400, 500, 600, 700, 800, 900],
              },
            },
            {
              header: {
                font: "Space Grotesk",
                weights: [300, 400, 500, 600, 700],
              },
              body: {
                font: "Public Sans",
                weights: [100, 200, 300, 400, 500, 600, 700, 800, 900],
              },
            },
            {
              header: { font: "Archivo", weights: [400, 500, 600, 700] },
              body: {
                font: "Rubik",
                weights: [300, 400, 500, 600, 700, 800, 900],
              },
            },
          ],
        },
        {
          category: "Strong and Professional",
          pairs: [
            {
              header: {
                font: "Oswald",
                weights: [200, 300, 400, 500, 600, 700],
              },
              body: { font: "Monda", weights: [400, 700] },
            },
            {
              header: { font: "Anton", weights: [400] },
              body: {
                font: "Urbanist",
                weights: [300, 400, 500, 600, 700, 800, 900],
              },
            },
            {
              header: { font: "Bebas Neue", weights: [400] },
              body: {
                font: "Kanit",
                weights: [300, 400, 500, 600, 700, 800, 900],
              },
            },
            {
              header: { font: "Teko", weights: [300, 400, 500, 600, 700] },
              body: { font: "Chivo", weights: [300, 400, 500, 600, 700, 900] },
            },
          ],
        },
        {
          category: "Tech and Futuristic",
          pairs: [
            {
              header: {
                font: "Orbitron",
                weights: [400, 500, 600, 700, 800, 900],
              },
              body: { font: "Rajdhani", weights: [300, 400, 500, 600, 700] },
            },
            {
              header: { font: "Audiowide", weights: [400] },
              body: { font: "Teko", weights: [300, 400, 500, 600, 700] },
            },
            {
              header: { font: "Syncopate", weights: [400, 700] },
              body: {
                font: "Saira",
                weights: [100, 200, 300, 400, 500, 600, 700, 800, 900],
              },
            },
            {
              header: { font: "Electrolize", weights: [400] },
              body: {
                font: "Oxanium",
                weights: [200, 300, 400, 500, 600, 700, 800],
              },
            },
          ],
        },
      ];

      const container = document.getElementById("font-container");

      commonThemes.forEach((category) => {
        // Create a heading for the category
        const categoryHeading = document.createElement("h2");
        categoryHeading.classList.add("theme-Headings");
        categoryHeading.textContent = category.category;
        container.appendChild(categoryHeading);

        let rowDiv = document.createElement("div");
        rowDiv.classList.add("font-row-theme");

        category.pairs.forEach((pair, index) => {
          // Create a font card
          const card = document.createElement("div");
          card.classList.add("theme-card");

          card.innerHTML = `
                  <h4 class="subheader">Header</h4>
                  <h3 class="header" style="font-family: '${pair.header.font}', sans-serif;">${pair.header.font}</h3>

                  <h4 class="subheader">Body/Subheader</h4>
                  <h3 class="body" style="font-family: '${pair.body.font}', sans-serif;">${pair.body.font}</h3>

                  <div class="divider"></div>

                  <h3 style= "font-family: '${pair.header.font}', sans-serif;" >Example</h3>
                  <p class="example" style="font-family: '${pair.body.font}', sans-serif;">
                      "The quick brown fox jumps over the fence"
                  </p>
              `;

          rowDiv.appendChild(card);

          // If two cards are added, append row to container and create a new row
          if ((index + 1) % 2 === 0 || index === category.pairs.length - 1) {
            container.appendChild(rowDiv);
            rowDiv = document.createElement("div");
            rowDiv.classList.add("font-row");
          }
          const popupOverlay = document.getElementById("saved-font-popup");
          let popupContent = document.getElementById("popup-font-details");
          const closePopupButton = document.getElementById("close-popup");

          const popupData = {};

          // ✅ Make the list item clickable to display saved option content
          card.addEventListener("click", async () => {
            console.log("Theme card clicked", pair);
            createPopupContent(popupContent, pair, false);

            popupOverlay.classList.add("open");

            // ✅ Dynamically Position the Pop-up Next to Sidebar
            let sidebar = document.getElementById("sidebar");
            let sidebarRect = sidebar.getBoundingClientRect();
            let menu = document.querySelector(".tabs");
            let menuRect = menu.getBoundingClientRect();
            popupOverlay.style.top = `${menuRect.bottom}px`; // Position right below the menu
            popupOverlay.style.left = `${sidebarRect.right}px`; // Position right of sidebar
          });
          // ✅ Close pop-up when clicking the close button
          closePopupButton.addEventListener("click", () => {
            popupOverlay.classList.remove("open");
          });

          // ✅ Close pop-up when clicking outside it
          // Select the tab elements
          const findFontTab = document.getElementById("find-font-tab");
          const resultsTab = document.getElementById("font-family-tab");
          const commonThemesTab = document.getElementById(
            "all-font-categories-tab"
          );

          // Function to close the popup
          const closePopup = () => {
            popupOverlay.classList.remove("open");
          };

          // Attach event listeners to the tabs
          findFontTab.addEventListener("click", closePopup);
          resultsTab.addEventListener("click", closePopup);
          commonThemesTab.addEventListener("click", closePopup);
        });
      });

      async function loadAllFonts() {
        const fontSet = new Set();

        // Extract unique fonts to avoid redundant loads
        commonThemes.forEach((theme) => {
          theme.pairs.forEach((pair) => {
            ["header", "body", "subheading"].forEach((type) => {
              const fontEntry = pair[type];
              if (fontEntry) {
                fontSet.add(fontEntry.font); // Store only font family
              }
            });
          });
        });

        // Convert set to array and load each font dynamically
        try {
          await Promise.all(
            Array.from(fontSet).map((font) => loadGoogleFont(font))
          );
          console.log("All fonts loaded successfully.");
        } catch (error) {
          console.error("Error loading fonts:", error);
        }
      }

      loadAllFonts(); // Load fonts when the script runs
    </script>
  </body>
</html>
